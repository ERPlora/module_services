{% extends "ui/module_content.html" %}
{% load static i18n ui %}

{% block content %}
{# General Settings #}
{% ui_card %}
    <h3 class="fs-lg fw-semibold mb-md">{% trans "General Settings" %}</h3>

    <ion-list>
        <ion-item>
            <ion-input
                label="{% trans 'Default Duration (minutes)' %}"
                label-placement="stacked"
                type="number"
                min="5"
                value="{{ config.default_duration }}"
                id="default_duration"
            ></ion-input>
        </ion-item>

        <ion-item>
            <ion-input
                label="{% trans 'Buffer Time (minutes)' %}"
                label-placement="stacked"
                type="number"
                min="0"
                value="{{ config.default_buffer_time }}"
                id="default_buffer_time"
            ></ion-input>
        </ion-item>

        <ion-item>
            <ion-input
                label="{% trans 'Default Tax Rate (%)' %}"
                label-placement="stacked"
                type="number"
                step="0.01"
                min="0"
                max="100"
                value="{{ config.default_tax_rate }}"
                id="default_tax_rate"
            ></ion-input>
        </ion-item>

        <ion-item>
            <ion-input
                label="{% trans 'Currency' %}"
                label-placement="stacked"
                value="{{ config.currency }}"
                id="currency"
                maxlength="3"
            ></ion-input>
        </ion-item>

        <ion-item>
            <ion-input
                label="{% trans 'Price Decimal Places' %}"
                label-placement="stacked"
                type="number"
                min="0"
                max="4"
                value="{{ config.price_decimal_places }}"
                id="price_decimal_places"
            ></ion-input>
        </ion-item>
    </ion-list>

    <ion-button expand="block" class="mt-md" id="saveSettingsBtn">
        <ion-icon slot="start" name="save-outline"></ion-icon>
        {% trans "Save Settings" %}
    </ion-button>
{% endui_card %}

{# Display Options #}
{% ui_card %}
    <h3 class="fs-lg fw-semibold mb-md">{% trans "Display Options" %}</h3>

    <ion-list>
        <ion-item>
            <ion-toggle
                hx-post="{% url 'services:settings_toggle' %}"
                hx-vals='{"field": "show_prices"}'
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-swap="none"
                {% if config.show_prices %}checked{% endif %}
            >{% trans "Show Prices" %}</ion-toggle>
        </ion-item>

        <ion-item>
            <ion-toggle
                hx-post="{% url 'services:settings_toggle' %}"
                hx-vals='{"field": "show_duration"}'
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-swap="none"
                {% if config.show_duration %}checked{% endif %}
            >{% trans "Show Duration" %}</ion-toggle>
        </ion-item>

        <ion-item>
            <ion-toggle
                hx-post="{% url 'services:settings_toggle' %}"
                hx-vals='{"field": "allow_online_booking"}'
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-swap="none"
                {% if config.allow_online_booking %}checked{% endif %}
            >{% trans "Allow Online Booking (default)" %}</ion-toggle>
        </ion-item>

        <ion-item>
            <ion-toggle
                hx-post="{% url 'services:settings_toggle' %}"
                hx-vals='{"field": "include_tax_in_price"}'
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-swap="none"
                {% if config.include_tax_in_price %}checked{% endif %}
            >{% trans "Include Tax in Price" %}</ion-toggle>
        </ion-item>
    </ion-list>
{% endui_card %}

{# Quick Links #}
{% ui_card %}
    <h3 class="fs-lg fw-semibold mb-md">{% trans "Manage" %}</h3>

    <ion-list>
        <ion-item href="{% url 'services:addon_list' %}" detail>
            <ion-icon slot="start" name="add-circle-outline" color="primary"></ion-icon>
            <ion-label>{% trans "Addons" %}</ion-label>
        </ion-item>
        <ion-item href="{% url 'services:package_list' %}" detail>
            <ion-icon slot="start" name="gift-outline" color="warning"></ion-icon>
            <ion-label>{% trans "Packages" %}</ion-label>
        </ion-item>
    </ion-list>
{% endui_card %}

<script>
document.getElementById('saveSettingsBtn').addEventListener('click', async function() {
    const data = {
        default_duration: document.getElementById('default_duration').value,
        default_buffer_time: document.getElementById('default_buffer_time').value,
        default_tax_rate: document.getElementById('default_tax_rate').value,
        currency: document.getElementById('currency').value,
        price_decimal_places: document.getElementById('price_decimal_places').value,
    };

    try {
        const response = await fetch('{% url "services:settings_save" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            Alpine.store('ui').success('{% trans "Settings saved" %}');
        } else {
            Alpine.store('ui').error(result.error);
        }
    } catch (error) {
        Alpine.store('ui').error('{% trans "Error saving settings" %}');
    }
});
</script>
{% endblock %}
